*--------------------------------------------------------------------------
* Model generated by Motega software: 
*
*              Modeling Of Tubes Employing Genetic Algorithms
*
* Models contain 1G resistors from all nodes to earth in order to avoid
* floating nodes. Triode and tetrode/pentode models contain a diode for
* simulating grid current.
*
* Non-commercial use is permitted, but at your own risk... This model
* is provided "as is", without warranty of any kind. In no event shall
* Jeroen Boschma be liable for any claim, damages or other liability,
* whether in an action of contract, tort or otherwise, arising from,
* out of or in connection with the tube model or the use or other
* dealings in the tube model.
*
*
*                         Copyright Jeroen Boschma
*                              www.boschma.com
*
* Motega V 1.0, 12-Sep-2010 23:58:18
*--------------------------------------------------------------------------

*--------------------------------------------------------------------------
* Generic tetrode/pentode model
*--------------------------------------------------------------------------

.SUBCKT TubePentode  A  Gr2  Gr1  K
+ PARAMS: ua=1 ug2=1 xa=1 xg2=1 qa=1 qg2=1 kg1=1 kg2=1 kvba=1 kvbg2=1 ce=1
*
* Resistors in order to avoid floating nodes
*
R1   A    0   1G
R2   Gr2  0   1G
R3   Gr1  0   1G
R4   K    0   1G
*
* Intermediate expressions which simplify the current calculation
*
RE1  1    0   1G
E1   1    0   VALUE={xa + ce*PWR(V(A,K),2)}
RE2  2    0   1G
E2   2    0   VALUE={V(Gr2,K)*LOG(1 + EXP(qa*(1/ua + V(Gr1,K)/V(Gr2,K))))/qa}
RE3  3    0   1G
E3   3    0   VALUE={V(Gr2,K)*LOG(1 + EXP(qg2*(1/ug2 + V(Gr1,K)/V(Gr2,K))))/qg2}
*
* Actual current calculation
*
G1   A    K   VALUE={(PWR(V(2),V(1)) + PWRS(V(2),V(1)))*ATAN(V(A,K)/kvba)/kg1}
G2   Gr2  K   VALUE={(PWR(V(3),V(1)) + PWRS(V(3),V(1)))*ATAN(V(A,K)/kvbg2)/kg2}
*
* Grid current modeling
*
RG   Gr1  4   1K
D1   4    K   DX
.MODEL DX D(IS=1N RS=1 CJO=10PF TT=1N)
*
* Close the model
*
.ENDS

*--------------------------------------------------------------------------
* Specialized tube model
*
*    Type           : 6Z43P
*    Description    : Pentode High S
*    Direct heated  : no
*    Screen present : yes
*--------------------------------------------------------------------------

.SUBCKT 6Z43P    A  Gr2  Gr1  K 
*
* Resistors in order to avoid floating nodes
*
* RF   F    0   1G
* RS   S    0   1G
*
* Link to the generic model
*
XV1     A         Gr2      Gr1      K       TubePentode
+ PARAMS: ua=76.129 ug2=8.581K xa=759.154M xg2=952.570M qa=233.302 qg2=151.489
+ kg1=68.216 kg2=142.261 kvba=19.057 kvbg2=2.179M ce=22.808U
*
* Capacitances
*
C1    K        A        3.300P   ; Cka
C2    Gr1      K        13.500P   ; Cgk
* C3    Gr1      F        0.150P   ; Cgh
C4    Gr1      A        0.075P   ; Cga
.ENDS

*--------------------------------------------------------------------------
* Specialized tube model
*
*    Type           : 6F12P
*    Description    : Pentode only
*    Direct heated  : no
*    Screen present : no
*--------------------------------------------------------------------------

.SUBCKT 6F12PP    A  Gr2  Gr1  K 
*
* Resistors in order to avoid floating nodes
*
* RF   F    0   1G
*
* Link to the generic model
*
XV1     A         Gr2      Gr1      K       TubePentode
+ PARAMS: ua=164.060 ug2=2.189K xa=442.879M xg2=687.751M qa=620.235 qg2=93.692
+ kg1=89.910 kg2=161.636 kvba=11.369 kvbg2=655.832 ce=358.645N
*
* Capacitances
*
C1    K        Gr1      6.600P   ; Ckg1
C2    K        A        1.900P   ; Cka
C3    Gr1      A        0.020P   ; Cg1a
*
* Close the model
*
.ENDS

.subckt 6BQ5_EL84_T 1 6 3
+ params: mu=18.8 ex=1.5 kg1=540 kp=165 kvb=174 rgi=1000 vct=0.01
+ ccg=10.5p cgp=4.9p ccp=6.5p
e1 7 0 value=
+{v(1,3)/kp*log(1+exp(kp*(1/mu+v(2,3)/sqrt(kvb+v(1,3)*v(1,3)))))}
re1 7 0 1g
g1 1 3 value= {(pwr(v(7),ex)+pwrs(v(7),ex))/kg1}
rcp 1 3 1g
c1 2 3 {ccg}
c2 1 2 {cgp}
c3 1 3 {ccp}
r1 2 5 {rgi}
v1 5 6 {vct}
d3 6 3 dx
.model dx d(is=1n rs=1 cjo=1pf tt=1n)
.ends

*
* AUTHOR: Totof
*
*
* 
* *
* Copyleft 2011
*
* liste des paramètres et ce que j'en ai déduit
* G = modifie la pente avant le coude pour les courbes d'anodes
* MU = modifie la pente après le coude pour les courbes d'anodes
* MU12 = modifie la hauteur du courant d'anode
* E1 = modifie l'écartement des courbes de courant d'anode 
* K1 = modifie l'angle du coude du courant d'anode
* K2 = ?
* k3 = modifie l'écartement des courbes avant le coude pour les courbes d'anodes
* k4 =  modifie la hauteur du courant d'écran
* K5 =  modifie la valeur maxi du courant d'écran pour les faibles valeurs de Va
* K6 = modifie l'angle du coude du courant d'écran
* K = modifie l'écartement des courbes de courant d'écran




.SUBCKT 6Z52P 1 2 3 4
* Anode G2 G1 Cathode
X1 1 2 3 4 PENTH1 G=.100m MU=10000 MU12=30.9 E1=4.6 k1=90.2 k2=2.1 k3=0.8 k4=85.6 k5=26.8 k6=10.6 K=4.50m
X2 3 4 Igrid ALPHA=.02m BETA=.1U
C2 1 4 1.8P
C3 3 1 .05P
C5 3 4 13.5P
RF1 1 4 200MEG
RF2 3 4 50MEG
RF3 2 4 100MEG
.ENDS





**************************************
**Modèle mathématique issu de EXCEM **
**************************************



******************
.SUBCKT PENTH1 A G2 G1 C

* Terme d'ecran
B1 10 0 V=IF(V(A,C)>0,(V(G2,C)/{MU12})*(V(A,C)-({k3}*V(G1,C)))/((V(G2,C)/{k1})+V(A,C)),0)

* Total
B2 A C I={G}*((V(G1,C)+V(10,0))+(V(A,C)/({MU}*(1-(V(G1,C)/{k2})))))**{E1}

* Calcul du courant d'ecran
B6 12 0 V=IF(V(G2,C)>0,(V(G1,C)+(V(G2,C)/{k4})),0)
B7 G2 C I={K}*(V(12,0)**1.5)*((V(A,C)+{k5})/(V(A,C)+{k6}))**3
.ENDS

******************
.SUBCKT Igrid G1 C
* Courant grille
B4 6 0 V=IF(V(G1,C)>0,{ALPHA}*V(G1,C)**1.5,{BETA}/-(V(G1,C)-.1))
B5 G1 C I=V(6,0)
.ENDS
******************

.SUBCKT 6V6 P S G K
.MODEL DX D(IS=1N RS=1 CJO=1PF TT=1N)
Esp 	2  	0  	VALUE={V(P,K)+13.49*V(S,K)+130.4*V(G,K)}
E1  	3  	2  	VALUE={5.521E-7*(PWR(V(2),1.5)+PWRS(V(2),1.5))/2}
E2  	3  	4  	VALUE={5.521E-7*PWR(13.49*V(S,K),1.5)*V(P,K)/25}
E3  	5  	4  	VALUE={(1-V(4,2)/ABS(V(4,2)+0.001))/2}
R1  	5  	0  	1.0K
Gk  	S  	K  	VALUE={V(3,2)}
Gp  	P  	S  	VALUE={0.92*(V(3,4)*(1-V(5,4))+V(3,2)*V(5,4))}
R3   	G 	10  	3k   	; FOR GRID CURRENT
D3   	10 	K	DX      ; FOR GRID CURRENT
Cgk 	G  	K  	4.5P
Cgs 	G  	S  	4.5P
Cgp 	G  	P  	0.7P
Cpk 	P 	K 	7.5P
.ENDS

.SUBCKT 6AQ5 P S G K
.MODEL DX D(IS=1N RS=1 CJO=1PF TT=1N)
Esp 	2  	0  	VALUE={V(P,K)+13.49*V(S,K)+130.4*V(G,K)}
E1  	3  	2  	VALUE={5.521E-7*(PWR(V(2),1.5)+PWRS(V(2),1.5))/2}
E2  	3  	4  	VALUE={5.521E-7*PWR(13.49*V(S,K),1.5)*V(P,K)/25}
E3  	5  	4  	VALUE={(1-V(4,2)/ABS(V(4,2)+0.001))/2}
R1  	5  	0  	1.0K
Gk  	S  	K  	VALUE={V(3,2)}
Gp  	P  	S  	VALUE={0.92*(V(3,4)*(1-V(5,4))+V(3,2)*V(5,4))}
R3   	G 	10  	3k   	; FOR GRID CURRENT
D3   	10 	K	DX      ; FOR GRID CURRENT
Cgk 	G  	K  	8P
Cgs 	G  	S  	4P
Cgp 	G  	P  	0.4P
Cpk 	P 	K 	8.5P
.ENDS

.SUBCKT 807 A S G K
Eat	at	0	VALUE={0.636*ATAN(V(A,K)/5)}
Eme	me	0	VALUE={PWR(LIMIT{V(A,K),0,2000},1.5)/1750}
Emu	mu	0	VALUE={PWRS(V(G,K),1-(LIMIT{-V(G,K),30,9999}-30)/2000)}
Egs	gs	0	VALUE={LIMIT{V(A,K)/2.5+V(S,K)*15.15+V(mu)*134,0,1E6}}
Egs2	gs2	0	VALUE={PWRS(V(gs),1.5)*0.8E-6}
Ecath  	cc    	0 	VALUE={LIMIT{V(gs2)*V(at),0,V(me)}}
Ga     	A     	K     	VALUE={V(cc)}
Escrn	sc	0	VALUE={0.76*V(gs2)*(1.1-V(at))}
Gs     	S     	K	VALUE={V(sc)*LIMIT{V(S,K),0,10}/10}
Gg	G	K	VALUE={PWR(LIMIT{V(G,K)+1,0,1E6},1.5)*(1.25-V(at))*650E-6}
Cg1	G	K	7.5p
Cgs	G	S	5.0p
Cak	A	K	8.2p
Cg1a	G	A	0.2p
.ENDS 

.SUBCKT EL803 A S G K
Eat at 0 VALUE={limit(0.636*ATAN(limit(V(A,K),0,200)/5.39935952007373),0,1e6)} ;arctangent shaping
Eme me 0 VALUE={0.000459037814532166*PWR(V(A,K),1.19017332861348)} ; diodeline
Egs gs1 0 VALUE={LIMIT(V(A,K)/12216.2805361082+V(S,K)/21.6080182096161+V(G,K)/0.878756035095985 ,0,1E6)}  ;the basic voltage
Egs2 gs2 0 VALUE={PWRS(V(gs1),1.48413876122404)*0.0030939788209251}  ;raise to the power and mult by perveance
Ga A K  VALUE={limit(V(gs2)*V(at),0,V(me))}  ; anode current limited per diode line
Gs S K  VALUE={1.06934398863015*V(gs2)*(1.1-V(at))}; screen current, reverse arctangent shaping
Gg G K VALUE={PWR(LIMIT(V(G,K)+-0.2500372391271 ,0,1E6),1.5)*(1.25-V(at))*-0.00098104133922726}  ; grid current
C1 G K 0.15p
C2 A K 8p
C3 G A 0.12p
C4 G S 10.4p
.ENDS EL803


 
**** EL41 _ EL41 ******************************************
* Created on 04/16/2024 07:21 using paint_kip.jar
* www.dmitrynizh.com/tubeparams_image.htm
* Plate Curves image file: EL41 - el41.png
* Data source link: <plate curves URL>
*----------------------------------------------------------------------------------
.SUBCKT EL41 P G2 G K ; LTSpice tetrode.asy pinout
* .SUBCKT EL41 _ EL41 P G K G2 ; Koren Pentode Pspice pinout
+ PARAMS: MU=23.2 KG1=687.5 KP=171.18 KVB=220.8 VCT=0.816 EX=1.344 KG2=72.84 KNEE=19.08 KVC=2.57
+ KLAM=5.95E-7 KLAMG=3.45E-4   KNK=-0.03762 KNG=0.01188 KNPL=17.25 KNSL=2.283 KNPR=94.8 KNSR=16.24
+ CCG=3P CGP=1.4P CCP=1.9P RGI=2000.0
* Vp_MAX=500 Ip_MAX=175 Vg_step=2 Vg_start=0 Vg_count=7
* X_MIN=66 Y_MIN=17 X_SIZE=1365 Y_SIZE=949 FSZ_X=1851 FSZ_Y=1183 XYGrid=false
* Rp=1400 Vg_ac=20 P_max=9 Vg_qui=-6 Vp_qui=300 
* showLoadLine=n showIp=y isDHP=n isPP=n isAsymPP=n isUL=n showDissipLimit=y 
* showIg1=n isInputSnapped=y addLocalNFB=n
* XYProjections=n harmonicPlot=y dissipPlot=n 
* UL=0.43 EG2=250 gridLevel2=n addKink=y isTanhKnee=n advSigmoid=n 
*----------------------------------------------------------------------------------
RE1  7 0  1G    ; DUMMY SO NODE 7 HAS 2 CONNECTIONS
E1   7 0  VALUE=  ; E1 BREAKS UP LONG EQUATION FOR G1.
+{V(G2,K)/KP*LOG(1+EXP((1/MU+(VCT+V(G,K))/SQRT(KVB+V(G2,K)*V(G2,K)))*KP))}
RE2  6 0  1G    ; DUMMY SO NODE 6 HAS 2 CONNECTIONS
E2  6 0  VALUE={(PWR(V(7),EX)+PWRS(V(7),EX))} ; Kg1 times KIT current
RE21 21 0 1
E21  21 0 VALUE={V(6)/KG1*ATAN(V(P,K)/KNEE)} ; Ip with knee but no slope and no kink
RE22 22 0 1 ; E22: kink curr deviation for plate
E22  22 0 VALUE={V(21)*LIMIT(KNK-V(G,K)*KNG,0,0.3)*(-ATAN((V(P,K)-KNPL)/KNSL)+ATAN((V(P,K)-KNPR)/KNSR))} 
G1   P  K  VALUE={V(21)*(1+KLAMG*V(P,K))+KLAM*V(P,K) + V(22)}
* Alexander Gurskii screen current, see audioXpress 2/2011, with slope and kink added
RE43 43 K 1G ; Dummy
E43  43 G2 VALUE={0} ; Dummy
G2   43 K  VALUE={V(6)/KG2*(KVC-ATAN(V(P,K)/KNEE))/(1+KLAMG*V(P,K))-V(22)}
RCP  P K  1G     ; FOR CONVERGENCE
C1   K G  {CCG}  ; CATHODE-GRID 1
C2   G P  {CGP}  ; GRID 1-PLATE
C3   K P  {CCP}  ; CATHODE-PLATE
R1   G 5  {RGI}  ; FOR GRID CURRENT   
D3   5 K  DX     ; FOR GRID CURRENT } 
.MODEL DX D(IS=1N RS=1 CJO=10PF TT=1N)
.ENDS
*$

 
* The following triode model is derived from pentode model, see above.
* In the triode model, all spice parameters come directly from the pentode model, except for Kg1,
* which for triode-strapped pentodes is derived from pentode's Kg1, Kg2 and Kvc as
*
*    4Kg1Kg2 / ((2Kvc-Pi)(2Kg1+PiKg2))

**** EL41 _ EL41 ******************************************
* Created on 04/16/2024 07:21 using paint_kit.jar 4.7 
* www.dmitrynizh.com/tubeparams_image.htm
* Plate Curves image file: EL41 - el41.png
* Data source link: <plate curves URL>
*----------------------------------------------------------------------------------
.SUBCKT TRIODE_EL41 1 2 3 ; Plate Grid Cathode
+ PARAMS: CCG=3P  CGP=1.4P CCP=1.9P RGI=2000
+ MU=23.2 KG1=62.5 KP=171.18 KVB=220.8 VCT=0.816 EX=1.344 
* Vp_MAX=500 Ip_MAX=175 Vg_step=2 Vg_start=0 Vg_count=7
* Rp=1400 Vg_ac=20 P_max=9 Vg_qui=-6 Vp_qui=300
* X_MIN=66 Y_MIN=17 X_SIZE=1365 Y_SIZE=949 FSZ_X=1851 FSZ_Y=1183 XYGrid=false
* showLoadLine=n showIp=y isDHT=n isPP=n isAsymPP=n showDissipLimit=y 
* showIg1=n gridLevel2=n isInputSnapped=y  
* XYProjections=n harmonicPlot=y dissipPlot=n 
*----------------------------------------------------------------------------------
E1 7 0 VALUE={V(1,3)/KP*LOG(1+EXP(KP*(1/MU+(VCT+V(2,3))/SQRT(KVB+V(1,3)*V(1,3)))))} 
RE1 7 0 1G  ; TO AVOID FLOATING NODES
G1 1 3 VALUE={(PWR(V(7),EX)+PWRS(V(7),EX))/KG1} 
RCP 1 3 1G   ; TO AVOID FLOATING NODES
C1 2 3 {CCG} ; CATHODE-GRID 
C2 2 1 {CGP} ; GRID=PLATE 
C3 1 3 {CCP} ; CATHODE-PLATE 
D3 5 3 DX ; POSITIVE GRID CURRENT 
R1 2 5 {RGI} ; POSITIVE GRID CURRENT 
.MODEL DX D(IS=1N RS=1 CJO=10PF TT=1N) 
.ENDS 
*$

 
**** EL41 _ EL41 ******************************************
* Created on 04/25/2024 07:06 using paint_kip.jar
* Better fit to EL41 datasheet Va/Ia curves 
*----------------------------------------------------------------------------------
.SUBCKT EL41_2 P G2 G K ; LTSpice tetrode.asy pinout
* .SUBCKT EL41 _ EL41 P G K G2 ; Koren Pentode Pspice pinout
+ PARAMS: MU=27.2 KG1=335.5 KP=124.63 KVB=6.12 VCT=0.472 EX=1.141 KG2=333.38 KNEE=17.4 KVC=2.57
+ KLAM=6.5E-7 KLAMG=3.21E-4   KNK=-0.02642 KNG=0.01164 KNPL=16.25 KNSL=7.26 KNPR=70.8 KNSR=10.15
+ CCG=3P CGP=1.4P CCP=1.9P RGI=2000.0
* Vp_MAX=500 Ip_MAX=175 Vg_step=2 Vg_start=0 Vg_count=7
* X_MIN=74 Y_MIN=17 X_SIZE=1358 Y_SIZE=949 FSZ_X=1884 FSZ_Y=1183 XYGrid=false
* Rp=1400 Vg_ac=20 P_max=9 Vg_qui=-6 Vp_qui=300 
* showLoadLine=n showIp=y isDHP=n isPP=n isAsymPP=n isUL=n showDissipLimit=y 
* showIg1=n isInputSnapped=y addLocalNFB=n
* XYProjections=n harmonicPlot=y dissipPlot=n 
* UL=0.43 EG2=250 gridLevel2=n addKink=y isTanhKnee=n advSigmoid=n 
*----------------------------------------------------------------------------------
RE1  7 0  1G    ; DUMMY SO NODE 7 HAS 2 CONNECTIONS
E1   7 0  VALUE=  ; E1 BREAKS UP LONG EQUATION FOR G1.
+{V(G2,K)/KP*LOG(1+EXP((1/MU+(VCT+V(G,K))/SQRT(KVB+V(G2,K)*V(G2,K)))*KP))}
RE2  6 0  1G    ; DUMMY SO NODE 6 HAS 2 CONNECTIONS
E2  6 0  VALUE={(PWR(V(7),EX)+PWRS(V(7),EX))} ; Kg1 times KIT current
RE21 21 0 1
E21  21 0 VALUE={V(6)/KG1*ATAN(V(P,K)/KNEE)} ; Ip with knee but no slope and no kink
RE22 22 0 1 ; E22: kink curr deviation for plate
E22  22 0 VALUE={V(21)*LIMIT(KNK-V(G,K)*KNG,0,0.3)*(-ATAN((V(P,K)-KNPL)/KNSL)+ATAN((V(P,K)-KNPR)/KNSR))} 
G1   P  K  VALUE={V(21)*(1+KLAMG*V(P,K))+KLAM*V(P,K) + V(22)}
* Alexander Gurskii screen current, see audioXpress 2/2011, with slope and kink added
RE43 43 K 1G ; Dummy
E43  43 G2 VALUE={0} ; Dummy
G2   43 K  VALUE={V(6)/KG2*(KVC-ATAN(V(P,K)/KNEE))/(1+KLAMG*V(P,K))-V(22)}
RCP  P K  1G     ; FOR CONVERGENCE
C1   K G  {CCG}  ; CATHODE-GRID 1
C2   G P  {CGP}  ; GRID 1-PLATE
C3   K P  {CCP}  ; CATHODE-PLATE
R1   G 5  {RGI}  ; FOR GRID CURRENT   
D3   5 K  DX     ; FOR GRID CURRENT } 
.MODEL DX D(IS=1N RS=1 CJO=10PF TT=1N)
.ENDS
*$

 
* The following triode model is derived from pentode model, see above.
* In the triode model, all spice parameters come directly from the pentode model, except for Kg1,
* which for triode-strapped pentodes is derived from pentode's Kg1, Kg2 and Kvc as
*
*    4Kg1Kg2 / ((2Kvc-Pi)(2Kg1+PiKg2))

**** EL41 _ EL41 ******************************************
* Created on 04/25/2024 07:06 using paint_kit.jar 4.7 
* www.dmitrynizh.com/tubeparams_image.htm
* Plate Curves image file: EL41 - el41.png
* Data source link: <plate curves URL>
*----------------------------------------------------------------------------------
.SUBCKT TRIODE_EL41_2  1 2 3 ; Plate Grid Cathode
+ PARAMS: CCG=3P  CGP=1.4P CCP=1.9P RGI=2000
+ MU=27.2 KG1=130.29 KP=124.63 KVB=6.12 VCT=0.472 EX=1.141 
* Vp_MAX=500 Ip_MAX=175 Vg_step=2 Vg_start=0 Vg_count=7
* Rp=1400 Vg_ac=20 P_max=9 Vg_qui=-6 Vp_qui=300
* X_MIN=74 Y_MIN=17 X_SIZE=1358 Y_SIZE=949 FSZ_X=1884 FSZ_Y=1183 XYGrid=false
* showLoadLine=n showIp=y isDHT=n isPP=n isAsymPP=n showDissipLimit=y 
* showIg1=n gridLevel2=n isInputSnapped=y  
* XYProjections=n harmonicPlot=y dissipPlot=n 
*----------------------------------------------------------------------------------
E1 7 0 VALUE={V(1,3)/KP*LOG(1+EXP(KP*(1/MU+(VCT+V(2,3))/SQRT(KVB+V(1,3)*V(1,3)))))} 
RE1 7 0 1G  ; TO AVOID FLOATING NODES
G1 1 3 VALUE={(PWR(V(7),EX)+PWRS(V(7),EX))/KG1} 
RCP 1 3 1G   ; TO AVOID FLOATING NODES
C1 2 3 {CCG} ; CATHODE-GRID 
C2 2 1 {CGP} ; GRID=PLATE 
C3 1 3 {CCP} ; CATHODE-PLATE 
D3 5 3 DX ; POSITIVE GRID CURRENT 
R1 2 5 {RGI} ; POSITIVE GRID CURRENT 
.MODEL DX D(IS=1N RS=1 CJO=10PF TT=1N) 
.ENDS 
*$



